# 장치 컨트롤러와 장치 드라이버

## 입출력 장치 왜 다루기 까다로울까 ?

- 종류가 너무나 많음
- 일반적으로 CPU와 메모리의 데이터 전송률은 높지만 입출력장치의 데이터 전송률은 낮음

## 장치 컨트롤러(입출력 제어기, 입출력 모듈)

### 역할

- CPU와 입출력 장치 간의 통신 중개(일종의 번역가 역할)
- 오류 검출
- 데이터 버퍼링
    - 버퍼링
        
        → 전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 버퍼라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법
        

### 구조

- 데이터 레지스터
    - CPU와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터(버퍼)
    - RAM을 사용하기도 함
- 상태 레지스터
    - 상태 정보 저장
        - 입출력장치 입출력 작업을 할 준비가 되었는지
        - 입출력 작업이 완료 되었는지
        - 입출력장치에 오류는 없는지 등의 상태 정보
- 제어 레지스터
    - 입출력장치가 수행할 내용에 대한 제어 정보

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%8E%E1%85%AE%E1%86%AF%E1%84%85%E1%85%A7%E1%86%A8%E1%84%8C%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%B5%20c60c8a1695ac4681a3eedd68fef63d29/Untitled.png)

## 장치 드라이버


- 장치 컨트롤러의 동작을 감지하고 제어하는 프로그램
- 장치 컨트롤러가 컴퓨터 내부와 정보 주고 받을 수 있게 해주는 프로그램
- 입출력 장치를 연결하기 위한 소프트웨어적인 통로

# 다양한 입출력 방법

## 프로그램 입출력


- 프로그램 속 명령어로 입출력 장치를 제어하는 방법
- 입출력 명령어로써 장치 컨트롤러와 상호작용
- CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로써 이루어짐

### 메모리에 저장된 정보를 하드 디스크에 백업

1. CPU는 하드 디스크 컨트롤러의 제어 레지스터에 쓰기 명령 내보내기
2. 하드 디스크 컨트롤러는 하드 디스크 상태 확인 → 상태 레지스터에 준비 완료 표시
3. CPU는 상태 레지스터를 주기적으로 읽어보며 하드 디스크 준비 여부 확인 → 하드 디스크 준비되었다면 백업할 메모리의 정보를 데이터 레지스터에 쓰기

### 프로그램 입출력 방식

- 메모리 맵 입출력
    - 메모리에 접근하기 위한 주소 공간과 입출력 장치에 접근하기 위한 주소 공간 하나의 주소 공간으로 간주
        
        ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%8E%E1%85%AE%E1%86%AF%E1%84%85%E1%85%A7%E1%86%A8%E1%84%8C%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%B5%20c60c8a1695ac4681a3eedd68fef63d29/Untitled%201.png)
        
- 고립형 입출력
    - 메모리 위한 주소 공간과 입출력 장치를 위한 주소 공간을 분리하는 방법
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%8E%E1%85%AE%E1%86%AF%E1%84%85%E1%85%A7%E1%86%A8%E1%84%8C%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%B5%20c60c8a1695ac4681a3eedd68fef63d29/Untitled%202.png)
    
    - 입출력 전용 명령어를 사용
- 비교

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%8E%E1%85%AE%E1%86%AF%E1%84%85%E1%85%A7%E1%86%A8%E1%84%8C%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%B5%20c60c8a1695ac4681a3eedd68fef63d29/Untitled%203.png)

## 인터럽트 기반 입출력

- 하드웨어 인터럽트는 장치 컨트롤러에 의해 발생

### 동시다발적 인터럽트

- 단순히 발생 순서대로 처리
    - 현실적으로 불가능
- 우선 순위를 반영한 인터럽트
    - PIC라는 하드웨어 사용
        - 여러 장치 컨트롤러에 연결되어 하드웨어 인터럽트의 우선 순위를 판단한 뒤 CPU에게 지금 처리해야 할 인터럽트 판단
        - NMI의 우선순위까지 판단하지는 X

## DMA 입출력

- CPU를 거치지 않고 입출력장치가 메모리에 직접적으로 접근하는 기능
- 과정에서 시스템 버스를 사용, 시스템 버스 공용 자원이기에 동시 사용 X (사이클 스틸링)
    - CPU가 이용하지 않을 때 조금씩 이용
    - CPU에게 허락을 구하고 이용

### 과정

1. CPU는 DMA 컨트롤러에 입출력 작업을 명령
2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행
3. 입출력 작업이 끝나면 DMA 컨트롤러는 인터럽트를 통해 CPU에 작업이 끝났음을 알림

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%8E%E1%85%AE%E1%86%AF%E1%84%85%E1%85%A7%E1%86%A8%E1%84%8C%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%B5%20c60c8a1695ac4681a3eedd68fef63d29/Untitled%204.png)

<aside>
💡 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하기도 하며  CPU는 입출력 작업의 시작과 끝만 관여

</aside>

### 입출력 버스

- 입출력 버스를 통해 시스템 버스의 이용 빈도 낮추기 위해
- PCI 버스, PCI express 버스
- 슬롯 → 입출력 버스 → 시스템 버스 순 연결

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%8E%E1%85%AE%E1%86%AF%E1%84%85%E1%85%A7%E1%86%A8%E1%84%8C%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%B5%20c60c8a1695ac4681a3eedd68fef63d29/Untitled%205.png)